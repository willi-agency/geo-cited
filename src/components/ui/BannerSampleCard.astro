---
import type { FeatureSection } from "@/schemas/features";
import RowForm from "../forms/RowForm.astro";
import { Icon } from "astro-icon/components";

export interface Props {
  section: FeatureSection;
}

const {
  variant = "dark",
  layout = "center",
  tag,
  title,
  subtitle,
  items,
  cta,
  description,
  sampleList,
  image,
  showForm = false,
} = Astro.props.section;

// VARIANT HANDLER
const variantClass = {
  dark: "bg-zinc-900 text-white",
  white: "bg-white text-zinc-900",
  primary:
    "bg-gradient-to-tr from-[#FF5700] via-[#FF742C] to-[#FF7933] text-white",
}[variant];

const bgSection = {
  dark: "bg-zinc-50 text-zinc-900",
  white: "bg-zinc-800 text-white",
  primary: "bg-white text-primary-700",
}[variant];

// LAYOUT HANDLER
const isImageLeft = layout === "image-left";
const isImageRight = layout === "image-right";
const hasImage = Array.isArray(image)
  ? image.length > 0
  : !!image;
---
<section class={`w-full overflow-hidden flex flex-col items-center justify-center px-4 py-10 md:px-10 md:py-20 ${bgSection}`}>
  <div class={`w-full overflow-hidden max-w-7xl flex flex-col gap-10 items-center justify-center rounded-3xl px-4 py-6 md:px-10 md:py-16 ${variantClass}`}>

    <!-- TAG / TITLE / SUBTITLE -->
    <div class="flex flex-col gap-2 items-center justify-center fade-in" data-delay-animation="300">
      {tag && <span class="text-base font-semibold">{tag}</span>}
      <h2 class="text-4xl font-semibold">{title}</h2>
      {subtitle && <p class="text-base opacity-80">{subtitle}</p>}
    </div>

    <hr class="w-full border-b border-white/25">

    <!-- METRICS GRID -->
    <div class="w-full max-w-5xl grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3  justify-items-center items-center justify-center">
      {items?.list?.map(item => (
        <h3 class={`w-full max-w-56 md:max-w-80 flex flex-col gap-1 items-center justify-center rounded-4xl p-4 ${bgSection} fade-up`}>
          <span class="text-3xl md:text-5xl font-bold">
            {item.bigNumber}
          </span>
          <span class="text-sm">{item.label}</span>
        </h3>
      ))}
    </div>

    <!-- CTA + FORM -->
    <div class="w-full flex flex-col justify-center items-center gap-4 mt-10 fade-up">
      {description && (
        <h3 class="text-3xl font-semibold">{description}</h3>
      )}
      {cta?.label && (
        <a href={cta.href} class={`btn btn-${cta.variant} btn-xl`}>
          {cta.label}
        </a>
      )}

      {showForm && 
      <RowForm idValidation="index-card-bignumber"
      extraClassesForm="max-w-3xl" 
      extraClassesInput = {variant === "dark" ? "bg-white! text-zinc-500!" : variant === "white" ? "bg-zinc-900! text-zinc-50" : "bg-white! text-zinc-500!"}
      variant={variant === "dark" ? "btn-primary-solid" : variant === "white" ? "btn-primary-solid" : "btn-dark-solid"} 
      />}

      {items?.list && (
        <div class="w-full sm:w-fit flex flex-col sm:flex-row gap-2 sm:gap-8 sm:items-center justify-center">
          {sampleList?.map(item => (
            <span class="w-full sm:w-fit flex items-center gap-1 text-sm">
              <Icon width={18} height={18} name="lucide:check" /> {item}
            </span>
          ))}
        </div>
      )}
    </div>
  </div>
</section>
