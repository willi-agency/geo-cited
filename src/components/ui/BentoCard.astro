---
import type { BentoGridSection } from "src/schemas/bento";
import type { CTA } from "src/schemas/features"; 
import { Icon } from "astro-icon/components";
import { Image } from 'astro:assets';

export interface Props {
  section: BentoGridSection;
}

const {
  tag,
  title,
  description,
  cta,
  ctas = [],
  items = [],
  grid = "grid-cols-2 sm:grid-cols-3 md:gap-6 xl:gap-8",
  variant = "white"
} = Astro.props.section;

const allCtas = [...ctas, cta].filter((btn): btn is CTA => Boolean(btn));
---

<section class={`w-full py-10 md:py-16 ${variant === "dark" ? "bg-gray-900 text-white" : "bg-white"}`}>
  <div class="mx-auto max-w-screen-2xl px-4 md:px-8">

    <!-- Header -->
    <div class="mb-8 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-6">

      <div class="flex flex-col gap-3">
        {tag && <span class="text-primary font-medium">{tag}</span>}

        {title && (
          <h2 class="text-3xl md:text-4xl font-bold" set:html={title} />
        )}

        {description && (
          <p class="max-w-lg opacity-80">{description}</p>
        )}
      </div>

      <!-- CTAs -->
      {allCtas.length > 0 && (
        <div class="flex items-center gap-3 flex-wrap">
          {allCtas.map(btn => (
            <a
              href={btn.href}
              class={`inline-flex items-center gap-2 rounded-lg px-4 py-2 font-semibold text-sm transition ${btn.customClass || ""} btn-${btn.variant}`}
            >
              {btn.label}
              {btn.icon && <Icon name={btn.icon} class="w-4 h-4" />}
            </a>
          ))}
        </div>
      )}
    </div>

    <!-- Bento Grid -->
    <div class={`grid gap-4 md:gap-6 xl:gap-8 ${grid}`}>
      {items.map(item => (
        <a
          href={item.href || "#"}
          class={`group relative flex h-48 md:h-80 items-end overflow-hidden rounded-lg bg-gray-100 shadow-lg 
          ${item.colSpan || ""} ${item.rowSpan || ""}`}
        >
          <Image
            width={600}
            height={400}
            src={item.image.href}
            alt={item.image.alt}
            loading="lazy"
            class="absolute inset-0 h-full w-full object-cover object-center transition duration-300 group-hover:scale-110"
          />

          {item.overlay && (
            <div class="pointer-events-none absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent opacity-60"></div>
          )}

          {item.label && (
            <span class="relative ml-4 mb-3 inline-block text-sm text-white md:text-lg">
              {item.label}
            </span>
          )}
        </a>
      ))}
    </div>

  </div>
</section>
